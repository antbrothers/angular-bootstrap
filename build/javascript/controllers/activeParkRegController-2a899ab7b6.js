var activeParkModuble=angular.module("activeParkRegController",[]);activeParkModuble.controller("activeParkRegCtrl",["$scope","$location","$state","$stateParams","activeParkService","localStorageService","$interval","loginService",function(e,r,o,a,n,c,t,i){e.userCode=r.search(),e.openId={};var l="2.0.1";e.activeParkVo={appVersion:l},e.activeParkHelper={phoneText:"获取验证码",phoneUnSend:!0},e.activeParkVo.wxpayOpenid=c.get("userWxOpenIdSixThree"),e.customerId=c.get("userWxCustomerIdSixThree"),""==e.activeParkVo.wxpayOpenid||null==e.activeParkVo.wxpayOpenid||""==e.customerId||null==e.customerId?i.getOpenId(e.userCode.code).success(function(r){e.openId=r.openId,e.activeParkVo.wxpayOpenid=r.openId}).error(function(){}):o.go("home.activeParkfail"),void 0!=r.search().parkName&&_czc.push(["_trackEvent","扫描二维码","车场名称",""+r.search().parkName,,"boxiang"]),e.checkMobileReg=function(){var r=$.helpTool().checkOnlyMobile(e.activeParkVo.mobile);r?e.activeParkForm.apPhone.$setValidity("phoneReg",!0,"apPhone"):e.activeParkForm.apPhone.$setValidity("phoneReg",!1,"apPhone")},e.sendCheckCode=function(){if(0!=e.activeParkHelper.phoneUnSend){if(1==e.activeParkForm.apPhone.$error.phoneReg)return $.helpTool().errorWarning(null,{desc:"请输入正确手机号",ver:"2"}).open(),void $.helpTool().errorWarning("",{desc:"",ver:"2"}).remove();n.checkPhoneCode(e.activeParkVo.mobile).success(function(r){if(0==r.errorNum){$.helpTool().errorWarning(null,{desc:"发送成功",ver:"2"}).open(),$.helpTool().errorWarning("",{desc:"",ver:"2"}).remove(),e.activeParkHelper.phoneUnSend=!1;var o=60,a=t(function(){return o--,0==o?(e.activeParkHelper.phoneText="获取验证码",e.activeParkHelper.phoneUnSend=!0,t.cancel(a),void clearInterval(a)):void(e.activeParkHelper.phoneText="重新发送("+o+")")},1e3)}}).error(function(e){$.helpTool().loading().close(),$.helpTool().errorWarning("",{desc:"请求服务器失败"})})}},e.registerActive=function(){var r=n.request.send("registerActive",{params:e.activeParkVo},!1);r.then(function(r){0==r.data.errorNum?(c.set("userWxOpenIdSixThree",r.data.customer.wxpayOpenid),c.set("userWxCustomerIdSixThree",r.data.customer.customerId),o.go("home.activeParkSuccess",{phoneNum:e.activeParkVo.mobile})):1==r.data.errorNum?($.helpTool().errorWarning(null,{desc:r.data.errorInfo,ver:"2"}).open(),$.helpTool().errorWarning("",{desc:"",ver:"2"}).remove()):o.go("home.activeParkfail")})}}]),activeParkModuble.controller("activeParkSucCtrl",["$scope","$stateParams",function(e,r){e.activeParkSucVo={phoneNum:r.phoneNum}}]);