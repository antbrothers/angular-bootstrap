"use strict";var myControllers=angular.module("invitController",[]);myControllers.controller("invitCtrl",["$scope","$stateParams","invitService","localStorageService","authorize",function(e,r,t,o,a){console.log("invitCtrl"),e.parklistShow=!1,e.plot="",e.parkingId="",e.daoDate="",e.date=new Date,e.parkList="",e.name="",e.moblile="",e.carNumber="",e.historyData="",e.customerId=o.get("userWxCustomerIdSixThree"),e.parklist=!1;var n=60;if(clearInterval(window.timeId),e.queryHistory=function(){t.queryHistory(e.customerId,1,5).success(function(r){"0"==r.errorNum?(console.log(r),0!=r.data.length?(angular.element(".no_car").css("display","none"),angular.element(".has_data").css("display","block"),e.historyData=r.data):(angular.element(".no_car").css("display","block"),angular.element(".has_data").css("display","none"))):(angular.element(".no_car").css("display","block"),angular.element(".has_data").css("display","none"),$.helpTool().errorWarning("",{desc:r.errorInfo}))}).error(function(){$.helpTool().errorWarning("",{desc:"请求服务器失败"})})},e.queryHistory(),""==e.customerId||null==e.customerId){var l=a.path();e.encodeuri=encodeURI(""+l+"login&type=invit"),window.location.href=e.encodeuri}else t.queryVillageOwner(e.customerId).success(function(r){"0"==r.errorNum?0!=r.data.length&&(e.parkList=r.data,e.plot=r.data[0].parkingName,e.parkingId=r.data[0].parkingId):"1"==r.errorNum?layer.open({content:'尊敬的用户，您尚未在我司服务的小区名单中，如有疑问可以通过以下电话进行反馈，谢谢<br><a style="color: #3AD5B8" href="tel://4000062637">400-006-2637 </a>',btn:["确定"]}):$.helpTool().errorWarning("",{desc:r.errorInfo})}).error(function(e){$.helpTool().errorWarning("",{desc:"服务器繁忙"})});e.CurentTime=function(){var e=new Date,r=e.getFullYear(),t=e.getMonth()+1,o=e.getDate(),a=(e.getHours(),e.getMinutes(),e.getSeconds(),r+"");return 10>t&&(a+="0"),a+=t+"",10>o&&(a+="0"),a+=o+""},e.daoDate=e.CurentTime(),e.selectReplacePark=function(){e.parklistShow=!0},e.closeList=function(){e.parklistShow=!1},e.selectPark=function(r,t){e.plot=r,e.parkingId=t},angular.element(".how_take_time").mobiscroll().date({theme:"mobiscroll",lang:"zh",display:"bottom",minDate:new Date(e.date.getFullYear(),e.date.getMonth(),e.date.getDate()),maxDate:new Date(e.date.getFullYear(),e.date.getMonth(),e.date.getDate()+30),dateOrder:"yymmdd",dateFormat:"yymmdd",onSelect:function(r,t){e.$apply(function(){e.daoDate=r})}}),e.sendDx=function(){""==e.plot||""==e.parkingId?$.helpTool().errorWarning("",{desc:"请选择小区"}):""==e.daoDate?$.helpTool().errorWarning("",{desc:"请选择日期"}):""==e.moblile||void 0==e.moblile?$.helpTool().errorWarning("",{desc:"请输入手机号"}):/^1[3|4|5|7|8]\d{9}$/.test(e.moblile)?""!=e.carNumber&&7!=e.carNumber.length?$.helpTool().errorWarning("",{desc:"请输入正确的车牌号码"}):(window.timeId=setInterval(function(){0==n?($(".btn_replace_stop").attr("disabled",!1),$(".btn_replace_stop").text("发送邀请短信").css({background:"#3AD5B8",color:"white",border:"none"}),clearInterval(window.timeId),n=60):($(".btn_replace_stop").attr("disabled",!0),$(".btn_replace_stop").text("发送邀请短信("+n+")").css({background:"#CBC9C9",color:"white",border:"2px solid #CBC9C9"}),n--)},1e3),console.log(timeId),t.add(e.customerId,e.daoDate,e.parkingId,e.plot,e.name,e.moblile,e.carNumber).success(function(r){"0"==r.errorNum?(console.log(r),e.queryHistory()):(clearInterval(window.timeId),$.helpTool().errorWarning("",{desc:r.errorInfo}))}).error(function(){clearInterval(window.timeId),$.helpTool().errorWarning("",{desc:"服务器请求失败"})})):$.helpTool().errorWarning("",{desc:"请输入正确的手机号"})},e.mySplit=function(e){var r=e.split(",");return r}}]);