"use strict";var myControllers=angular.module("loginController",[]);myControllers.controller("loginCtrl",["$scope","$stateParams","loginService","$location","localStorageService","$timeout",function(e,r,o,t,n,c){console.log("登录"),e.userCode=t.search(),e.openId={},e.returnType=t.search().type,o.getOpenId(e.userCode.code).success(function(r){e.openId=r.openId}).error(function(){}),e.login=function(r,s){$.helpTool().checkMobile(r,s)&&o.login(r,s,e.openId).success(function(r){"0"==r.errorNum?(e.userWxOpenIdSixThree=n.get("userWxOpenIdSixThree"),e.userWxCustomerIdSixThree=n.get("userWxCustomerIdSixThree"),console.log("customerId:"+n.get("userWxCustomerIdSixThree")+";opendId:"+e.userWxOpenIdSixThree),c(function(){e.$apply(function(){n.set("userWxOpenIdSixThree",r.customer.wxpayOpenid),n.set("userWxCustomerIdSixThree",r.customer.customerId),e.userWxOpenIdSixThree=n.get("userWxOpenIdSixThree"),e.userWxCustomerIdSixThree=n.get("userWxCustomerIdSixThree"),"boxiang"!=e.returnType&&("temporary"==e.returnType?(e.encodeuri=encodeURI("http://p-share.cn/wx_share/wxpay/getAuthor?backUri=http://p-share.cn/wx_share/wxpay/getCode?directUrl=http://p-share.cn/wx_share/html5/templates/temporary.html"),window.location.href=e.encodeuri):(e.encodeuri="/home/"+e.returnType,t.path(e.encodeuri)))})},0)):$.helpTool().errorWarning("#error_show",{desc:r.errorInfo})}).error(function(e){$.helpTool().errorWarning("#error_show",{desc:"服务器繁忙"})})},e.checkPhone=function(e){return/^1[3|4|5|7|8]\d{9}$/.test(e)?!0:($.helpTool().errorWarning("#error_show",{desc:"请输入正确手机号"}),!1)},e.zhuChe=function(){"boxiang"!=e.returnType?(e.encodeuri=encodeURI("http://p-share.cn/wx_share/wxpay/getAuthor?backUri=http://p-share.cn/wx_share/wxpay/getCode?directUrl=http://p-share.cn/wx_share/html5/views/index.html%23/home/register&type="+e.returnType),window.location.href=e.encodeuri):(e.encodeuri=encodeURI("http://p-share.cn/wx_share/wxpay/getAuthor?backUri=http://p-share.cn/wx_share/wxpay/getCode?directUrl=http://p-share.cn/wx_share/html5/views/index.html%23/home/register"),window.location.href=e.encodeuri)}}]),myControllers.controller("loginFreeCtrl",["$scope","$stateParams","registerService","loginService","$location","localStorageService","$timeout",function(e,r,o,t,n,c,s){console.log("免密登录"),console.log("登录"),e.userCode=n.search(),e.openId={},e.returnType=n.search().type,t.getOpenId(e.userCode.code).success(function(r){e.openId=r.openId}).error(function(){});var i=60;clearInterval(window.timeId),e.getCode=function(e){$.helpTool().checkMobile(e,"123456")&&($(".code_txt").attr("disabled",!0),window.timeId=setInterval(function(){0==i?($(".code_txt").attr("disabled",!1),$(".code_txt").text("获取验证码").css({background:"white",color:"#3AD5B8",border:"2px solid #3AD5B8"}),clearInterval(window.timeId),i=60):($(".code_txt").attr("disabled",!0),$(".code_txt").text("重新获取("+i+")").css({background:"#CBC9C9",color:"white",border:"2px solid #CBC9C9"}),i--)},1e3),console.log(timeId),o.getCode(e).success(function(e){_czc.push(["_trackEvent","获取验证码","请求","发送",,"code"]),"0"!=e.errorNum&&$.helpTool().errorWarning("#error_show",{desc:"获取验证码失败"})}).error(function(){$(".code_txt").attr("disabled",!1),$(".code_txt").text("获取验证码").css({background:"white",color:"#3AD5B8",border:"2px solid #3AD5B8"}),clearInterval(window.timeId),$.helpTool().errorWarning("#error_show",{desc:"获取验证码失败"})}))},e.login=function(r,o){$.helpTool().checkMobile(r,"123456")&&t.login(r,o,e.openId).success(function(r){"0"==r.errorNum?(_czc.push(["_trackEvent","免密登录","跳转","链接",,"loginFree"]),e.userWxOpenIdSixThree=c.get("userWxOpenIdSixThree"),e.userWxCustomerIdSixThree=c.get("userWxCustomerIdSixThree"),console.log("customerId:"+c.get("userWxCustomerIdSixThree")+";opendId:"+e.userWxOpenIdSixThree),s(function(){e.$apply(function(){c.set("userWxOpenIdSixThree",r.customer.wxpayOpenid),c.set("userWxCustomerIdSixThree",r.customer.customerId),e.userWxOpenIdSixThree=c.get("userWxOpenIdSixThree"),e.userWxCustomerIdSixThree=c.get("userWxCustomerIdSixThree"),"boxiang"!=e.returnType&&("temporary"==e.returnType?(e.encodeuri=encodeURI("http://p-share.cn/wx_share/wxpay/getAuthor?backUri=http://p-share.cn/wx_share/wxpay/getCode?directUrl=http://p-share.cn/wx_share/html5/templates/temporary.html"),window.location.href=e.encodeuri):(e.encodeuri="/home/"+e.returnType,n.path(e.encodeuri)))})},0)):$.helpTool().errorWarning("#error_show",{desc:r.errorInfo})}).error(function(e){$.helpTool().errorWarning("#error_show",{desc:"服务器繁忙"})})},e.zhuChe=function(){"boxiang"!=e.returnType?(e.encodeuri=encodeURI("http://p-share.cn/wx_share/wxpay/getAuthor?backUri=http://p-share.cn/wx_share/wxpay/getCode?directUrl=http://p-share.cn/wx_share/html5/views/index.html%23/home/register&type="+e.returnType),window.location.href=e.encodeuri):(e.encodeuri=encodeURI("http://p-share.cn/wx_share/wxpay/getAuthor?backUri=http://p-share.cn/wx_share/wxpay/getCode?directUrl=http://p-share.cn/wx_share/html5/views/index.html%23/home/register"),window.location.href=e.encodeuri)}}]);