"use strict";var myControllers=angular.module("proChartController",[]);myControllers.controller("proChartCtrl",["$scope","proChartService","$location","$timeout",function(e,t,a,r){console.log("proChartCtrl"),e.param=a.search(),e.userId="2016060100000097",e.date=new Date,e.year=e.date.getFullYear(),e.mouth=e.date.getMonth()+1,e.carStop="",e.parkingId="",e.myScroll="",e.loaded=function(){e.myScroll=new IScroll("#wrapper",{scrollX:!0,scrollY:!1,mouseWheel:!0,click:!0})},e.loaded(),e.mouthArr=[],e.P={y:"",m:""};var o=e.mouth,s=1,i=12;for(o;o>=s;o--)if(e.P={y:e.year,m:o},e.mouthArr.push(e.P),1==o)for(i;i>e.mouth;i--)e.P={y:e.year-1,m:i},e.mouthArr.push(e.P);console.log(e.mouthArr);var l={title:{text:""},xAxis:{categories:[]},colors:["#f9c75d","#67c7ee","#5eccb6"],yAxis:{title:{text:""},plotLines:[{value:0,width:1,color:"#808080"}]},credits:{enabled:!1},tooltip:{pointFormat:'<tr><td style="color: {series.color}">{series.name}: </td><td style="text-align: right"><b>￥{point.y:.1f}</b></td></tr>'},legend:{layout:"horizontal",align:"center",verticalAlign:"top",borderWidth:0},series:[]},n={chart:{type:"column"},title:{text:""},xAxis:{categories:[]},credits:{enabled:!1},yAxis:[{min:0,title:{text:""}},{title:{text:""},opposite:!0}],legend:{shadow:!1},tooltip:{shared:!0,pointFormat:"{series.name}:￥<b>{point.y:.1f}</b>"},plotOptions:{column:{grouping:!1,shadow:!1,borderWidth:0}},series:[{name:"预期",color:"#fed978",data:[],pointPadding:.3,pointPlacement:-.2},{name:"实际",color:"#88daf6",data:[],pointPadding:.4,pointPlacement:-.2}]};e.getData=function(a,r,o,s){t.getLineData(a,r,o,s).success(function(t){if("0"==t.errorNum){e.weekDesc=t.data.weekDesc,e.weekDate=t.data.weekDate,l.xAxis.categories.splice(0,l.xAxis.categories.length);for(var a=0;a<t.data.xAxis.length;a++)l.xAxis.categories.push(t.data.xAxis[a]);l.series.splice(0,l.series.length);for(var r=0;r<t.data.dayStatisticsMap.length;r++)l.series.push(t.data.dayStatisticsMap[r])}console.log(l.xAxis.categories),$("#line_container").highcharts(l)}).error(function(){$.helpTool().errorWarning("",{desc:"服务器繁忙"})}),t.getColumnData(a,r,o,s).success(function(t){if("0"==t.errorNum){e.monthly=t.data.monthly,e.monthtime=t.data.monthtime,n.xAxis.categories.splice(0,n.xAxis.categories.length),n.series[0].data.splice(0,n.series[0].data.length),n.series[1].data.splice(0,n.series[1].data.length);for(var a=0;a<t.data.xAxis.length;a++)n.xAxis.categories.push(t.data.xAxis[a]);for(var r=0;r<t.data.dayStatisticsMap.length;r++)n.series[0].data.push(t.data.dayStatisticsMap[r]);for(var o=0;o<t.data.factPrice.length;o++)n.series[1].data.push(t.data.factPrice[o])}$("#column_container").highcharts(n)}).error(function(){$.helpTool().errorWarning("",{desc:"服务器繁忙"})})},t.getParking(e.userId).success(function(t){"0"==t.errorNum?(e.carStop=t.parkingList[0].parkingName,e.parkingId=t.parkingList[0].parkingId,e.carList=t.parkingList,e.getData(e.year,e.mouth,e.userId,e.parkingId)):$.helpTool().errorWarning("",{desc:t.errorInfo})}),e.selectMouth=function(t,a,o){r(function(){e.$apply(function(){e.year=a,e.mouth=o})},0),$("#scroller ul li").removeClass("active"),angular.element(t.target).closest("li").addClass("active"),console.log(o),e.getData(a,o,e.userId,e.parkingId)},e.openCarStop=function(){console.log("openCarstop"),angular.element(".pro_car_cont").css("display","block"),angular.element(".chart_cont").css({position:"fixed","overflow-y":"hidden"})},e.selectCar=function(t,a){console.log("212"),e.carStop=t,e.parkingId=a,angular.element(".pro_car_cont").css("display","none"),angular.element(".chart_cont").css({position:"relative","overflow-y":"scroll"}),e.getData(e.year,e.mouth,e.userId,e.parkingId)},e.closeCarlist=function(){angular.element(".pro_car_cont").css("display","none"),angular.element(".chart_cont").css({position:"relative","overflow-y":"scroll"})},e.defaultMonth=function(){for(var t=0;t<$("#scroller ul li").length;t++)$($("#scroller ul li")[t]).attr("dataVuel")==e.mouth&&$($("#scroller ul li")[t]).addClass("active")},e.defaultMonth()}]);