"use strict";var myControllers=angular.module("replaceStopController",[]);myControllers.controller("replaceStopCtrl",["$scope","replaceStopService","$state","$location","localStorageService","$timeout","authorize",function(e,n,r,a,t,o,i){function l(r){n.getCanParkList(r.position.lng,r.position.lat).success(function(n){$.helpTool().loading().close(),"0"==n.errorNum?(e.parkName=n.data[0].parkingName,e.parkId=n.data[0].parkingId,e.parkList=n.data):$.helpTool().errorWarning("",{desc:n.errorInfo})}).error(function(){$.helpTool().errorWarning("",{desc:"服务器繁忙"})})}function s(r){$.helpTool().loading().close(),n.getCanParkList("","").success(function(n){$.helpTool().loading().close(),"0"==n.errorNum?e.parkList=n.data:$.helpTool().errorWarning("",{desc:n.errorInfo})}).error(function(){$.helpTool().errorWarning("",{desc:"服务器繁忙"})})}if(e.openId=t.get("userWxOpenIdSixThree"),e.customerId=t.get("userWxCustomerIdSixThree"),console.log("customerId:"+t.get("userWxCustomerIdSixThree")+";opendId:"+t.get("userWxOpenIdSixThree")),console.log("代泊"),""==e.openId||null==e.openId||""==e.customerId||null==e.customerId){var c=i.path();e.encodeuri=encodeURI(""+c+"login&type=replaceStop"),window.location.href=e.encodeuri}else angular.element(".empty_page").css("display","none");if(e.parklist=!1,e.plate=t.get("userCarNumber"),e.data={},e.data.num1="",e.data.num2="",e.data.num3="",e.data.num4="",e.data.num5="",e.data.num6="",e.data.num7="",console.log(e.plate),""==e.plate||null==e.plate||void 0==e.plate);else if(7==e.plate.length){var u=e.plate.replace(/(.)(?=[^$])/g,"$1,").split(",");e.data.num1=u[0],e.data.num2=u[1],e.data.num3=u[2],e.data.num4=u[3],e.data.num5=u[4],e.data.num6=u[5],e.data.num7=u[6]}e.parkName="",e.parkId="",e.price="0",e.takeTime="",e.date=new Date,e.CurentTime=function(){var e=new Date,n=e.getFullYear(),r=e.getMonth()+1,a=e.getDate(),t=e.getHours(),o=e.getMinutes(),i=e.getSeconds(),l=n+"-";return 10>r&&(l+="0"),l+=r+"-",10>a&&(l+="0"),l+=a+" ",10>t&&(l+="0"),l+=t+":",10>o&&(l+="0"),l+=o+":",10>i&&(l+="0"),l+=i},e.date.getHour=e.CurentTime(),$.helpTool().loading().open();var d,g;d=new AMap.Map("mapcontainer",{resizeEnable:!0}),d.plugin("AMap.Geolocation",function(){g=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"}),d.addControl(g),g.getCurrentPosition(),AMap.event.addListener(g,"complete",l),AMap.event.addListener(g,"error",s)}),angular.element(".how_take_time").mobiscroll().datetime({theme:"mobiscroll",lang:"zh",display:"bottom",minDate:new Date(e.date.getFullYear(),e.date.getMonth(),e.date.getDate(),e.date.getHours(),e.date.getMinutes()),maxDate:new Date(e.date.getFullYear(),e.date.getMonth(),e.date.getDate()+1,23,59),dateOrder:"yymmdd",timeWheels:"HHii",dateFormat:"yy-mm-dd",timeFormat:"HH:ii:ss",onSelect:function(r,a){n.getTakeTimePrice(e.parkId,e.date.getHour,r,"001").success(function(n){console.log(n),"0"==n.errorNum?(angular.element(".btn_replace_stop").attr("disabled",!1).css("background-color","#3AD5B8"),e.description=n.data.description,e.price=n.data.price):($.helpTool().errorWarning("",{desc:n.errorInfo}),angular.element(".btn_replace_stop").attr("disabled",!0).css("background-color","#909090"))}).error(function(e){$.helpTool().errorWarning("",{desc:"服务器繁忙"})})}}),e.selectReplacePark=function(){e.parklist=!0},e.selectPark=function(n,r){o(function(){e.$apply(function(){e.parkName=n,e.parkId=r,e.takeTime="",e.price="0",e.parklist=!1})},100)},e.nowReplace=function(){var r=angular.element(".agreeCheck").attr("checked");return"checked"!=r?($.helpTool().errorWarning("",{desc:"请同意协议"}),!1):void(""==e.plate||null==e.plate?$.helpTool().errorWarning("",{desc:"请输入车牌号"}):e.plate.length<7?$.helpTool().errorWarning("",{desc:"请输入正确的车牌号"}):""==e.takeTime?$.helpTool().errorWarning("",{desc:"请选择取车时间"}):(t.set("userCarNumber",e.plate),n.getOrderC(e.customerId,e.plate,e.parkId,e.date.getHour,e.takeTime,"0").success(function(n){"0"==n.errorNum?e.dialogBox(n):"1"==n.errorNum?e.busyDialoBox(n):$.helpTool().errorWarning("",{desc:n.errorInfo})}).error(function(){$.helpTool().errorWarning("",{desc:"服务器繁忙"})})))},e.dialogBox=function(e){angular.element(".dialog_btn_right").showDialog().open({dialogHead:"恭喜您",dialogDesc:"成功订购口袋停代泊业务！",dialogEndTimeTxt:"取车时间为:",dialogEndTimeValue:e.data.endTime,preTxt:"预计费用:",PrePrice:e.data.price+"元",relate:"您的车管家联系电话为:",relateTel:e.data.parkerMobile,status:"",btn:["取消","查看订单"],cancelCallBack:function(){angular.element(".dialog_box_content").remove()},checkOrder:function(e){console.log("查看订单"),angular.element(".dialog_box_content").remove(),r.go("home.replaceOrder")}})},e.busyDialoBox=function(r){angular.element(".dialog_btn_right").showDialog().open({dialogHeadCorlor:"#B1B1B1",dialogHead:"现在车管家都在忙碌中",dialogDesc:'<div style="color: #5F5F5F">前面等待<span style="color:rgb(58, 213, 184);font-size: 18px">'+r.data.count+"</span>辆车</div>",dialogEndTimeTxt:"预计代泊时间为:",dialogEndTimeValue:"",preTxt:r.data.startTime,PrePrice:"",relate:"请问是否继续下单?",relateTel:"",status:"",btn:["取消","继续"],cancelCallBack:function(){angular.element(".dialog_box_content").remove()},checkOrder:function(r){console.log("忙碌中"),n.getOrderC(e.customerId,e.plate,e.parkId,e.date.getHour,e.takeTime,"1").success(function(n){"0"==n.errorNum?e.dialogBox(n):$.helpTool().errorWarning("",{desc:n.errorInfo})}).error(function(){$.helpTool().errorWarning("",{desc:"服务器繁忙"})})}})},e.closeList=function(){e.parklist=!1},e.agree=function(e){var n=angular.element("."+e).attr("checked");"checked"==n?(angular.element("."+e).attr("checked",!1),angular.element(".checkImg").attr("src","../images/disagree.png")):void 0==n&&(angular.element("."+e).attr("checked",!0),angular.element(".checkImg").attr("src","../images/agree.png"))},e.licensePlate=function(){n.getProvince().success(function(n){$(".jianpan").show(),p=0,m=angular.element(".currnt").attr("data-val"),e.name=n.licensePlate}),T=angular.element(".currnt").attr("data-val"),$(this).css({border:"1px solid #3AD5B8"})},e.EnglishNumber=function(){n.getEnglishNumber().success(function(n){$(".jianpan").show(),p=0,m=angular.element(".currnt").attr("data-val"),e.name=n.EnglishNumber}),T=angular.element(".currnt").attr("data-val"),$(this).css({border:"1px solid #3AD5B8"})},e.focusEle=function(e){$("#"+e).focus(),$(".button").css({border:"1px solid #E5E5E5"}),$("#"+e).css({border:"1px solid #3AD5B8"})},e.parseInt=parseInt;var p="0",m="",T="";e.click=function(r,a){switch(r.stopPropagation(),T=""+(parseInt(m)+parseInt(p)),console.log("getNum0 = "+m),console.log("numAll0 = "+T),T){case"1":e.data.num1=a,e.focusEle(2),n.getEnglishNumber().success(function(n){e.name=n.EnglishNumber,m=1,1==m?p=1:2==m?p=0:3==m?p=-1:4==m?p=-2:5==m?p=-3:6==m?p=-4:7==m&&(p=-5),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),e.plate=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML)});break;case"2":e.data.num2=a,e.focusEle(3),n.getEnglishNumber().success(function(n){e.name=n.EnglishNumber,m=2,1==m?p=2:2==m?p=1:3==m?p=0:4==m?p=-1:5==m?p=-2:6==m?p=-3:7==m&&(p=-4),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),e.plate=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML)});break;case"3":e.data.num3=a,e.focusEle(4),n.getEnglishNumber().success(function(n){e.name=n.EnglishNumber,m=3,1==m?p=3:2==m?p=2:3==m?p=1:4==m?p=0:5==m?p=-1:6==m?p=-2:7==m&&(p=-3),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),e.plate=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML)});break;case"4":e.data.num4=a,e.focusEle(5),n.getEnglishNumber().success(function(n){e.name=n.EnglishNumber,m=4,1==m?p=4:2==m?p=3:3==m?p=2:4==m?p=1:5==m?p=0:6==m?p=-1:7==m&&(p=-2),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),e.plate=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML)});break;case"5":e.data.num5=a,e.focusEle(6),n.getEnglishNumber().success(function(n){e.name=n.EnglishNumber,m=5,1==m?p=5:2==m?p=4:3==m?p=3:4==m?p=2:5==m?p=1:6==m?p=0:7==m&&(p=-1),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),e.plate=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML)});break;case"6":e.data.num6=a,e.focusEle(7),n.getEnglishNumber().success(function(n){e.name=n.EnglishNumber,m=6,1==m?p=6:2==m?p=5:3==m?p=4:4==m?p=3:5==m?p=2:6==m?p=1:7==m&&(p=0),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),e.plate=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML)});break;case"7":e.data.num7=a,e.focusEle(1),n.getProvince().success(function(n){e.name=n.licensePlate,m=7,1==m?p=0:2==m?p=-1:3==m?p=-2:4==m?p=-3:5==m?p=-4:6==m?p=-5:7==m&&(p=-6),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),e.plate=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML)})}};var H;e.clear=function(r){r.stopPropagation(),H=T--,1==H?(e.data.num1="",m=1):2==H?(e.data.num2="",m=2):3==H?(e.data.num3="",m=3):4==H?(e.data.num4="",m=4):5==H?(e.data.num5="",m=5):6==H?(e.data.num6="",m=6):7==H?(e.data.num7="",m=7):(T=0,m=1),console.log("numAll="+T),console.log("getNum="+m),$(".button").css({border:"1px solid #E5E5E5"}),0==T?n.getProvince().success(function(n){$(".jianpan").show(),p=0,e.name=n.licensePlate}):n.getEnglishNumber().success(function(n){$(".jianpan").show(),p=0,e.name=n.EnglishNumber})},$("body").click(function(){$(".jianpan").hide()})}]);