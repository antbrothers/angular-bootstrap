var myController=angular.module("reservedParkController",[]);myController.controller("reservedParkCtrl",["$scope","reservedParkService","$timeout","localStorageService","authorize",function(e,o,n,r,a){function l(o){e.dataBind(o.position.lat,o.position.lng,e.pageIndex,e.pageSize)}function i(e){angular.element(".empty").css("display","none"),$.helpTool().loading().close(),$.helpTool().errorWarning("",{desc:"定位失败"})}if(console.log("预约停车"),e.openId=r.get("userWxOpenIdSixThree"),e.customerId=r.get("userWxCustomerIdSixThree"),""==e.openId||null==e.openId||""==e.customerId||null==e.customerId){var t=a.path();e.encodeuri=encodeURI(""+t+"login&type=reservedPark"),window.location.href=e.encodeuri}$.helpTool().loading().open(),e.pageIndex="1",e.pageSize="8",e.parkData=[],e.more=!1,e.dataBind=function(r,a,l,i){o.getCanParkList(r,a,l,i).success(function(o){if(angular.element(".empty").css("display","none"),$.helpTool().loading().close(),console.log(o),"0"==o.errorNum)e.parkData=e.parkData.concat(o.data),o.data.length<8&&(e.more=!0,e.imgSrc="../images/bg_pic_1.png",e.desc="更多停车场敬请期待"),n(function(){e.$watch("$viewContentLoaded",function(){var n,l=$("#up-icon"),i=$("#down-icon");n=new IScroll("#wrapper",{probeType:3,mouseWheel:!0,click:!0}),n.on("scroll",function(){var e=this.y,o=this.maxScrollY-e,n=i.hasClass("reverse_icon"),r=l.hasClass("reverse_icon");return e>=40?(!n&&i.addClass("reverse_icon"),""):40>e&&e>0?(n&&i.removeClass("reverse_icon"),""):o>=40?(!r&&l.addClass("reverse_icon"),""):40>o&&o>=0?(r&&l.removeClass("reverse_icon"),""):void 0}),n.on("slideUp",function(){this.maxScrollY-this.y>40&&(console.log("长度:"+o.data.length),$.helpTool().loading().open(),console.log("slideUp"),e.$apply(function(){e.pageIndex=parseInt(e.pageIndex)+1,console.log("第"+e.pageIndex+"页"),e.dataBind(r,a,e.pageIndex,e.pageSize)}),l.removeClass("reverse_icon"))})})},500);else if("1"==o.errorNum){e.more=!0;var l;l=new IScroll("#wrapper",{probeType:3,mouseWheel:!0})}else $.helpTool().errorWarning("",{desc:o.errorInfo})}).error(function(e){angular.element(".empty").css("display","none"),$.helpTool().loading().close(),$.helpTool().errorWarning("",{desc:"服务繁忙"})})};var s,c;s=new AMap.Map("mapcontainer",{resizeEnable:!0}),s.plugin("AMap.Geolocation",function(){c=new AMap.Geolocation({enableHighAccuracy:!0,timeout:5e3,buttonOffset:new AMap.Pixel(10,20),zoomToAccuracy:!0,buttonPosition:"RB"}),s.addControl(c),c.getCurrentPosition(),AMap.event.addListener(c,"complete",l),AMap.event.addListener(c,"error",i)}),e.goTo=function(e){alert(e)}}]);