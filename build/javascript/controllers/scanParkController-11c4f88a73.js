var myController=angular.module("scanParkController",[]);myController.controller("scanParkCtrl",["$scope","scanParkService","$state","$location","localStorageService","authorize",function(e,r,o,t,a,n){if(e.openId=a.get("userWxOpenIdSixThree"),e.customerId=a.get("userWxCustomerIdSixThree"),console.log("customerId:"+a.get("userWxCustomerIdSixThree")+";opendId:"+a.get("userWxOpenIdSixThree")),console.log("扫码代泊"),""==e.openId||null==e.openId||""==e.customerId||null==e.customerId){var l=n.path();e.encodeuri=encodeURI(""+l+"login&type=scanPark"),window.location.href=e.encodeuri}else angular.element(".empty_page").css("display","none");e.parklist=!1,e.plate=a.get("userCarNumber"),e.parkName="",e.parkId="",e.price="0",e.takeTime="",e.date=new Date,e.CurentTime=function(){var e=new Date,r=e.getFullYear(),o=e.getMonth()+1,t=e.getDate(),a=e.getHours(),n=e.getMinutes(),l=e.getSeconds(),i=r+"-";return 10>o&&(i+="0"),i+=o+"-",10>t&&(i+="0"),i+=t+" ",10>a&&(i+="0"),i+=a+":",10>n&&(i+="0"),i+=n+":",10>l&&(i+="0"),i+=l},e.date.getHour=e.CurentTime(),r.getCanParkList("","").success(function(r){$.helpTool().loading().close(),angular.element(".processOrder").css("display","none"),"0"==r.errorNum?e.parkList=r.data:$.helpTool().errorWarning("",{desc:r.errorInfo})}).error(function(){$.helpTool().errorWarning("",{desc:"服务器繁忙"})}),angular.element(".how_take_time").mobiscroll().datetime({theme:"mobiscroll",lang:"zh",display:"bottom",minDate:new Date(e.date.getFullYear(),e.date.getMonth(),e.date.getDate(),e.date.getHours(),e.date.getMinutes()),maxDate:new Date(e.date.getFullYear(),e.date.getMonth(),e.date.getDate()+1,23,59),dateOrder:"yymmdd",timeWheels:"HHii",dateFormat:"yy-mm-dd",timeFormat:"HH:ii:ss",onSelect:function(o,t){r.getTakeTimePrice(e.parkId,e.date.getHour,o,"001").success(function(r){console.log(r),"0"==r.errorNum?(angular.element(".btn_replace_stop").attr("disabled",!1).css("background-color","#3AD5B8"),e.description=r.data.description,e.price=r.data.price):($.helpTool().errorWarning("",{desc:r.errorInfo}),angular.element(".btn_replace_stop").attr("disabled",!0).css("background-color","#909090"))}).error(function(e){$.helpTool().errorWarning("",{desc:"服务器繁忙"})})}}),e.selectReplacePark=function(){e.parklist=!0},e.selectPark=function(r,o){e.parkName=r,e.parkId=o,e.parklist=!1},e.nowReplace=function(){""==e.plate||null==e.plate?$.helpTool().errorWarning("",{desc:"请输入车牌号"}):e.plate.length<7?$.helpTool().errorWarning("",{desc:"请输入正确的车牌号"}):""==e.takeTime?$.helpTool().errorWarning("",{desc:"请选择取车时间"}):(a.set("userCarNumber",e.plate),r.getOrderC(e.customerId,e.plate,e.parkId,e.date.getHour,e.takeTime,"0").success(function(r){"0"==r.errorNum?e.dialogBox(r):"1"==r.errorNum?e.busyDialoBox(r):$.helpTool().errorWarning("",{desc:r.errorInfo})}).error(function(){$.helpTool().errorWarning("",{desc:"服务器繁忙"})}))},e.dialogBox=function(e){angular.element(".dialog_btn_right").showDialog().open({dialogHead:"恭喜您",dialogDesc:"成功订购口袋停代泊业务！",dialogEndTimeTxt:"取车时间为:",dialogEndTimeValue:e.data.endTime,preTxt:"预计费用:",PrePrice:e.data.price+"元",relate:"您的车管家联系电话为:",relateTel:e.data.parkerMobile,status:"",btn:["取消","查看订单"],cancelCallBack:function(){angular.element(".dialog_box_content").remove()},checkOrder:function(e){console.log("查看订单"),angular.element(".dialog_box_content").remove(),o.go("home.replaceOrder")}})},e.busyDialoBox=function(o){angular.element(".dialog_btn_right").showDialog().open({dialogHeadCorlor:"#B1B1B1",dialogHead:"现在车管家都在忙碌中",dialogDesc:'<div style="color: #5F5F5F">前面等待<span style="color:rgb(58, 213, 184);font-size: 18px">'+o.data.count+"</span>辆车</div>",dialogEndTimeTxt:"预计代泊时间为:",dialogEndTimeValue:"",preTxt:o.data.startTime,PrePrice:"",relate:"请问是否继续下单?",relateTel:"",status:"",btn:["取消","继续"],cancelCallBack:function(){angular.element(".dialog_box_content").remove()},checkOrder:function(o){console.log("忙碌中"),r.getOrderC(e.customerId,e.plate,e.parkId,e.date.getHour,e.takeTime,"1").success(function(r){"0"==r.errorNum?e.dialogBox(r):$.helpTool().errorWarning("",{desc:r.errorInfo})}).error(function(){$.helpTool().errorWarning("",{desc:"服务器繁忙"})})}})},e.closeList=function(){e.parklist=!1}}]);