var myController=angular.module("temPayControllers",[]);myController.controller("temPayCtrl",["$scope","$timeout","$location","temPayService","localStorageService","authorize",function(n,e,r,a,t,i){if(console.log("临停缴费"),n.openId=t.get("userWxOpenIdSixThree"),n.customerId=t.get("userWxCustomerIdSixThree"),""==n.openId||null==n.openId||""==n.customerId||null==n.customerId){var o=i.path();n.encodeuri=encodeURI(""+o+"login&type=temPay"),window.location.href=n.encodeuri}else angular.element(".empty_page").css("display","none");void 0!=r.search().parkName&&_czc.push(["_trackEvent","扫描二维码微信缴费","车场名称",""+r.search().parkName,,"boxiang"]),n.data={},n.data.num1="",n.data.num2="",n.data.num3="",n.data.num4="",n.data.num5="",n.data.num6="",n.datq="",n.parklist=!1,n.parkingId="",n.parkName="",n.amountPayable="",n.beginDate="",n.parkingTime="";var c="",s="0",l="",u="";n.dateToDate=function(n){var e=new Date(n);if("object"==typeof n&&"function"==typeof(new Date).getMonth)e=n;else if("string"==typeof n){var r=n.split("-");3==r.length&&(e=new Date(r[0]+"-"+r[1]+"-"+r[2]))}return e},n.agree=function(n){var e=angular.element("."+n).attr("checked");"checked"==e?(angular.element("."+n).attr("checked",!1),angular.element(".checkImg").attr("src","../images/disagree.png")):void 0==e&&(angular.element("."+n).attr("checked",!0),angular.element(".checkImg").attr("src","../images/agree.png"))},n.nowReplace=function(){var e=angular.element(".agreeCheck").attr("checked");if("checked"==e){var r=c;if("7"!=r.length)return layer.open({content:'<h5 style="font-weight: bold">提示!</h5>车牌号码不正确',style:"width:100%;text-align:center",btn:["确认"]}),!1;var t="2016/01/01";"13"==n.enterType?t=n.effectEndTime:"14"==n.enterType&&(t=n.equityEffectEndTime),$.helpTool().loading().open(),a.orderc(n.parkingId,n.customerId,c,11,"","").success(function(e){$.helpTool().loading().close(),"0"==e.errorNum?(console.log("创建订单:"+e),a.getWxConfig().success(function(r){wx.config({appId:r.appId,timestamp:r.timestamp,nonceStr:r.nonceStr,signature:r.signature,jsApiList:["chooseWXPay"]}),wx.ready(function(){$.ajax({url:"/wx_share/wxpay/towxPay",type:"POST",dataType:"json",data:{money:e.order.amountPaid,body:"口袋停临停",openId:n.openId,orderNo:e.order.orderId,notify_url:"http://www.p-share.com/share/payment/wechat/backpay_"+e.order.orderType},success:function(n){wx.chooseWXPay({timestamp:n.timeStamp,nonceStr:n.nonceStr,"package":n["package"],signType:"MD5",paySign:n.sign,success:function(){window.location.href="http://p-share.cn/wx_share/html5/views/index.html#/home/paySuccess?orderId="+e.order.orderId+"&orderType=11"},fail:function(){}})},complete:function(){},error:function(){}})}),wx.error(function(){})})):($.helpTool().errorWarning("",{desc:e.errorInfo}),n.removeError())}).error(function(){$.helpTool().loading().close(),$.helpTool().errorWarning("",{desc:"请求服务失败"}),n.removeError()})}else void 0==e&&layer.open({content:'<h5 style="font-weight: bold">请同意协议!</h5>请对我们的协议进行阅读',style:"width:100%;text-align:center",btn:["确认"]})},n.onInputCarNumber=function(r,t){$.helpTool().loading().open(),a.getDataByScanOrMenu(r,t).success(function(r){if(console.log(r),"0"==r.errorNum)if(1==r.data.length)n.parkingId=r.data[0].parkingId,a.getOrderData(n.parkingId,n.customerId,t).success(function(r){console.log(r),e(function(){n.$apply(function(){n.datq=r.data})},0),$.helpTool().loading().close(),e(function(){n.$apply(function(){n.carNumber=t,n.parkName=r.data.data.parkingName,n.parkingId=r.data.data.parkingId})},0),e(function(){n.$apply(function(){n.amountPayable=r.data.data.amountPayable,n.beginDate=r.data.data.beginDate,n.parkingTime=r.data.data.parkingTime,n.parkName=r.data.data.parkingName})},0)});else{if("0"==r.errorNum&&(e(function(){n.$apply(function(){n.datq=r.data})},0),0!=r.data.length))for(var i=0;i<r.data.length;i++)e(function(){n.$apply(function(){n.parkName=r.data[i].parkingName,n.parkingId=r.data[i].parkingId,console.log(i)})},0);layer.open({content:'<h5 style="font-weight: bold">提示!</h5>当前车辆在多个车场有月租订单,请选择正确车场查询',style:"width:100%;text-align:center",btn:["确认"]})}else $.helpTool().loading().close(),e(function(){n.$apply(function(){n.amountPayable="",n.beginDate="",n.parkingTime="",n.parkName=""})},0)})},n.selectPark=function(r,t){n.parklist=!1,e(function(){n.$apply(function(){n.parkName=r,n.parkingId=t})},0);var i=c;"7"==i.length&&a.getOrderData(t,n.customerId,i).success(function(e){console.log(e),n.amountPayable=e.data.data.amountPayable,n.beginDate=e.data.data.beginDate,n.parkingTime=e.data.data.parkingTime}).error(function(){angular.element(".empty_page").css("display","none"),$.helpTool().loading().close(),$.helpTool().errorWarning("",{desc:"请求服务器失败"}),n.removeError()})},n.selectReplacePark=function(){n.parklist=!0},n.closeList=function(){n.parklist=!1},n.removeError=function(){e(function(){angular.element("#error_waring").remove()},1e3)},n.licensePlate=function(){a.getProvince().success(function(e){$(".jianpan").show(),s=0,l=angular.element(".currnt").attr("data-val"),n.name=e.licensePlate}),u=angular.element(".currnt").attr("data-val"),$(this).css({border:"1px solid #3AD5B8"})},n.EnglishNumber=function(){a.getEnglishNumber().success(function(e){$(".jianpan").show(),s=0,l=angular.element(".currnt").attr("data-val"),n.name=e.EnglishNumber}),u=angular.element(".currnt").attr("data-val"),$(this).css({border:"1px solid #3AD5B8"})},n.focusEle=function(n){$("#"+n).focus(),$(".button").css({border:"1px solid #E5E5E5"}),$("#"+n).css({border:"1px solid #3AD5B8"})},n.parseInt=parseInt,n.click=function(e,r){switch(e.stopPropagation(),u=""+(parseInt(l)+parseInt(s)),console.log(l),console.log(u),u){case"1":n.data.num1=r,n.focusEle(2),a.getEnglishNumber().success(function(e){n.name=e.EnglishNumber,l=1,1==l?s=1:2==l?s=0:3==l?s=-1:4==l?s=-2:5==l?s=-3:6==l?s=-4:7==l&&(s=-5),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),c=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML,n.onInputCarNumber(n.customerId,c))});break;case"2":n.data.num2=r,n.focusEle(3),a.getEnglishNumber().success(function(e){n.name=e.EnglishNumber,l=2,1==l?s=2:2==l?s=1:3==l?s=0:4==l?s=-1:5==l?s=-2:6==l?s=-3:7==l&&(s=-4),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),c=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML,n.onInputCarNumber(n.customerId,c))});break;case"3":n.data.num3=r,n.focusEle(4),a.getEnglishNumber().success(function(e){n.name=e.EnglishNumber,l=3,1==l?s=3:2==l?s=2:3==l?s=1:4==l?s=0:5==l?s=-1:6==l?s=-2:7==l&&(s=-3),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),c=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML,n.onInputCarNumber(n.customerId,c))});break;case"4":n.data.num4=r,n.focusEle(5),a.getEnglishNumber().success(function(e){n.name=e.EnglishNumber,l=4,1==l?s=4:2==l?s=3:3==l?s=2:4==l?s=1:5==l?s=0:6==l?s=-1:7==l&&(s=-2),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),c=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML,n.onInputCarNumber(n.customerId,c))});break;case"5":n.data.num5=r,n.focusEle(6),a.getEnglishNumber().success(function(e){n.name=e.EnglishNumber,l=5,1==l?s=5:2==l?s=4:3==l?s=3:4==l?s=2:5==l?s=1:6==l?s=0:7==l&&(s=-1),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),c=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML,n.onInputCarNumber(n.customerId,c))});break;case"6":n.data.num6=r,n.focusEle(7),a.getEnglishNumber().success(function(e){n.name=e.EnglishNumber,l=6,1==l?s=6:2==l?s=5:3==l?s=4:4==l?s=3:5==l?s=2:6==l?s=1:7==l&&(s=0),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),c=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML,n.onInputCarNumber(n.customerId,c))});break;case"7":n.data.num7=r,n.focusEle(1),a.getProvince().success(function(e){n.name=e.licensePlate,l=7,1==l?s=0:2==l?s=-1:3==l?s=-2:4==l?s=-3:5==l?s=-4:6==l?s=-5:7==l&&(s=-6),""!=$("#1")[0].innerHTML&&""!=$("#2")[0].innerHTML&&""!=$("#3")[0].innerHTML&&""!=$("#4")[0].innerHTML&&""!=$("#5")[0].innerHTML&&""!=$("#6")[0].innerHTML&&""!=$("#7")[0].innerHTML&&($(".button").css({border:"1px solid #E5E5E5"}),$(".jianpan").hide(),c=$("#1")[0].innerHTML+$("#2")[0].innerHTML+$("#3")[0].innerHTML+$("#4")[0].innerHTML+$("#5")[0].innerHTML+$("#6")[0].innerHTML+$("#7")[0].innerHTML,n.onInputCarNumber(n.customerId,c))})}};var d;n.clear=function(r){r.stopPropagation(),n.parkingId="",n.parkName="",n.amountPayable="",n.beginDate="",n.parkingTime="",d=u--,1==d?(n.data.num1="",l=1):2==d?(n.data.num2="",l=2):3==d?(n.data.num3="",l=3):4==d?(n.data.num4="",l=4):5==d?(n.data.num5="",l=5):6==d?(n.data.num6="",l=6):7==d?(n.data.num7="",l=7):(u=0,l=1),console.log("numAll+"+u),console.log("getNum="+l),$(".button").css({border:"1px solid #E5E5E5"}),0==u?a.getProvince().success(function(e){$(".jianpan").show(),s=0,n.name=e.licensePlate}):a.getEnglishNumber().success(function(e){$(".jianpan").show(),s=0,n.name=e.EnglishNumber}),""==$("#1")[0].innerHTML&&""==$("#2")[0].innerHTML&&""==$("#3")[0].innerHTML&&""==$("#4")[0].innerHTML&&""==$("#5")[0].innerHTML&&""==$("#6")[0].innerHTML&&""==$("#7")[0].innerHTML&&e(function(){n.$apply(function(){n.amountPayable="",n.beginDate="",n.parkingTime=""})},0)},$("body").click(function(){$(".jianpan").hide()})}]);